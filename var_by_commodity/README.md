### Purpose

Identify commodities with most price variance that could be indicative of trade mis-invoicing.

### Method

This script calculates the [coefficient of variation] (standard deviation / mean) for unit price across commodities.  For each commodity, for each month, the standard deviation and mean of unit price (`value/quantity_1`) is calculated across all country pairs.

This simple measure controls for the magnitude of the unit price which will be quite large for expensive goods (gold or laptops) but low for cheap goods (cement or bricks).  However, it does not capture any of the nuance in variations across time or any other dimension.  There are certainly more sophisticated methods to measure this (some within this repo), but this method does flag some low hanging fruit commodities with egrigious unit price variation.

### Filters & Caveats

This provides a framework for a for calculating the variance in commodity unit prices across all commodities.  However, in the current state, some naive assumptions and filters are applied.

* Only imported goods into EU/USA/Japan (`is_import=='t'`)
* Only goods priced in euros (`currency=='EUR'`).  Can be improved w/ [@margaretmf]'s exchange rate code.
* Only shipments measured in kilograms (`unit_1_id==24`)
* Only shipments valued at > 1 in quantity and value (`quantity_1>0 & value>1 & is.na(value)==F`) 

### How to Read Output

* `commodity_id`: commodity_id from trade table
* `sum_value`: sum of `value` (Euros) from trade table across all trade for the given commodity (summed across countries and months)
* `sd_unit1price`: coefficient of variation (sd/mean) of unit price (`value`/`quantity_1`) across all trades for the given commodity (across months and countries)
* `country_id_cnt`: count of unique countries exporting the given commodity
* `src_country_id_cnt`: count of unique countries importing the given commodity.
* `hs_code`: hs_code from commodity table
* `hs_description`: description of good from commodity table
* `anomalous_src_country`: top 3 countries w most unit price deviation.  Measured by the absolute value of the difference between the average unit price (across months) for each a country from the average unitprice across all countries.
* `anomalous_country`: same calculation as `anomalous_src_country`, but for `country_id`.
* `country_list_sortby_value` (not pictured here for brevity): list of all exporting countries sorted from most to least volume (measured by `value`) of the given commodity.
* `src_country_list_sortby_value`: same as `country_list_sortby_value`, but for the reporting source country (EU/Japan/USA).

[coefficient of variation]:https://en.wikipedia.org/wiki/Coefficient_of_variation
[@margaretmf]:https://github.com/margaretmf

### Top 20 Anomalous Commodities

More complete results in CSV in Google Drive (`gfi/results/variance_by_commodity`)

| commodity_id|  sum_value| sd_unit1price| country_id_cnt| src_country_id_cnt|hs_code  |hs_description                                                                                                                                                                                                                                                                                                                                                  |anomalous_src_country |anomalous_country |
|------------:|----------:|-------------:|--------------:|------------------:|:--------|:---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|:---------------------|:-----------------|
|        36801| 1158055337|      26.93071|             90|                 23|85359000 |ELECTRICAL APPARATUS FOR SWITCHING OR PROTECTING ELECTRICAL CIRCUITS, OR FOR MAKING CONNECTIONS TO OR IN ELECTRICAL CIRCUITS, FOR A VOLTAGE > 1.000 V (EXCL. FUSES, AUTOMATIC CIRCUIT BREAKERS, ISOLATING SWITCHES, MAKE-AND-BREAK SWITCHES, LIGHTNING ARRESTERS, VOLTAGE LIMITERS, SURGE SUPPRESSORS AND CONTROL DESKS, CABINETS, PANELS ETC. OF HEADING 8537) |ITA, GBR, ROU         |AGO, CHL, LKA     |
|        36592| 1166196595|      24.33336|             86|                 23|85168080 |ELECTRIC HEATING RESISTORS (EXCL. ELECTRIC HEATING RESISTORS ASSEMBLED WITH AN INSULATED FORMER OF AGGLOMERATED CARBON OR GRAPHITE)                                                                                                                                                                                                                             |GBR, IRL, NLD         |AND, BHR, QAT     |
|        31271|   22021773|      22.54771|             30|                 20|32072010 |ENGOBES ""SLIPS""                                                                                                                                                                                                                                                                                                                                               |ITA, BGR, ROU         |AUT, EST, ARE     |
|        35791|  279665803|      19.46587|             95|                 23|84253900 |WINCHES AND CAPSTANS, NON-POWERED BY ELECTRIC MOTOR                                                                                                                                                                                                                                                                                                             |ITA, GBR, CYP         |DZA, QAT, TZA     |
|        36635|    9669216|      18.41037|             32|                 21|85198125 |CASSETTE-TAPE PLAYERS ""PLAY ONLY"" USING MAGNETIC, OPTICAL OR SEMICONDUCTOR MEDIA, WITHOUT SOUND RECORDING DEVICE (EXCL. PLAYERS WITH AN ANALOGUE AND DIGITAL READING SYSTEM, TRANSCRIBING MACHINES AND POCKET SIZE)                                                                                                                                           |ROU, PRT, DEU         |AUS, JPN, PRT     |
|        37311|  209140586|      18.18170|             42|                 22|90085000 |IMAGE PROJECTORS, AND PHOTOGRAPHIC ENLARGERS AND REDUCERS (EXCL. CINEMATOGRAPHIC AND PARTS)                                                                                                                                                                                                                                                                     |MLT, LTU, BGR         |AGO, ROU, DNK     |
|        36704|    8193930|      17.55086|             24|                 21|85271210 |POCKET-SIZE RADIOCASSETTE PLAYERS [DIMENSIONS <= 170 MM X 100 MM X 45 MM], WITH AN ANALOGUE AND DIGITAL READING SYSTEM, WITH BUILT-IN AMPLIFIER, WITHOUT BUILT-IN LOUDSPEAKERS, CAPABLE OF BEING OPERATED WITHOUT AN EXTERNAL SOURCE OF POWER                                                                                                                   |ITA, POL, IRL         |BEL, IDN, DNK     |
|        31339|  685122163|      17.00759|             99|                 23|33012941 |ESSENTIAL OILS, NOT DETERPENATED, INCL. CONCRETES AND ABSOLUTES (EXCEPT OF CITRUS FRUIT, MINT, CLOVE, NIAOULI AND YLANG-YLANG)                                                                                                                                                                                                                                  |BGR, DEU, GBR         |AFG, VEN, BHS     |
|        34303|    4714992|      16.45231|             29|                 21|70181059 |IMITATION PRECIOUS AND SEMI-PRECIOUS STONES OF GLASS (EXCL. BEADS, CUT AND MECHANICALLY POLISHED, AND ARTICLES THEREOF)                                                                                                                                                                                                                                         |SVN, BGR, GBR         |THA, AUT, ITA     |
|        27732|   35515575|      15.69286|             64|                 22|03011900 |LIVE ORNAMENTAL FISH (EXCL. FRESHWATER)                                                                                                                                                                                                                                                                                                                         |DEU, SWE, AUT         |SVN, KIR, BLZ     |
|        34652|   28223612|      15.66147|             33|                 23|72199020 |FLAT-ROLLED PRODUCTS OF STAINLESS STEEL, OF A WIDTH OF >= 600 MM, HOT-ROLLED OR COLD-ROLLED ""COLD-REDUCED"" AND FURTHER WORKED, PERFORATED                                                                                                                                                                                                                     |CYP, MLT, LTU         |AUS, USA, TUN     |
|        35802|  625903122|      15.52868|             41|                 23|84269110 |HYDRAULIC CRANES DESIGNED FOR THE LOADING AND UNLOADING OF THE VEHICLE                                                                                                                                                                                                                                                                                          |PRT, CYP, BGR         |AUS, CHL, IND     |
|        30240|   36716512|      13.82017|             19|                 11|27101270 |JET FUEL, SPIRIT TYPE (EXCL. AVIATION SPIRIT)                                                                                                                                                                                                                                                                                                                   |ITA, NLD, ESP         |AUT, CAN, USA     |
|        33630|  591340974|      13.73201|             64|                 23|61161080 |MITTENS AND MITTS, IMPREGNATED, COATED OR COVERED WITH PLASTICS OR RUBBER, KNITTED OR CROCHETED, AND GLOVES, IMPREGNATED, COATED OR COVERED WITH PLASTICS, KNITTED OR CROCHETED                                                                                                                                                                                 |NLD, GBR, AUT         |AUS, BRA, RUS     |
|        30379|    7863765|      13.46090|             22|                 18|28100010 |DIBORON TRIOXIDE                                                                                                                                                                                                                                                                                                                                                |GRC, GBR, SVN         |AUS, FRA, SVK     |
|        32533|  183287959|      13.10252|             53|                 23|48054000 |FILTER PAPER AND PAPERBOARD, IN ROLLS OF A WIDTH > 36 CM OR IN SQUARE OR RECTANGULAR SHEETS WITH ONE SIDE > 36 CM AND THE OTHER SIDE > 15 CM IN THE UNFOLDED STATE                                                                                                                                                                                              |IRL, SVK, HUN         |IDN, AUS, IND     |
|        33260|   56835270|      12.85681|             52|                 23|56081120 |MADE-UP KNOTTED FISHING NETS OF TWINE, CORDAGE, ROPES OR CABLES, OF MAN-MADE TEXTILE MATERIALS (EXCL. LANDING NETS)                                                                                                                                                                                                                                             |AUT, PRT, ROU         |AUT, SVN, JPN     |
|        32713|  101536039|      11.88630|             21|                 18|51053900 |FINE ANIMAL HAIR, CARDED OR COMBED (EXCL. WOOL AND HAIR OF KASHMIR ""CASHMERE"" GOATS)                                                                                                                                                                                                                                                                          |HRV, DEU, HUN         |USA, ARG, NPL     |
|        32900|    1970930|      11.54893|             22|                 17|52122110 |WOVEN FABRICS OF COTTON, CONTAINING PREDOMINANTLY, BUT < 85% COTTON BY WEIGHT, MIXED PRINCIPALLY OR SOLELY WITH FLAX, WEIGHING > 200 G/M², UNBLEACHED                                                                                                                                                                                                           |HRV, ESP, ITA         |GBR, AUT, IND     |
|        35162|  265897065|      11.28252|             53|                 23|76082081 |TUBES AND PIPES OF ALUMINIUM ALLOYS, NOT FURTHER WORKED THAN EXTRUDED (EXCL. HOLLOW PROFILES)                                                                                                                                                                                                                                                                   |LTU, SVN, AUT         |AUS, HKG, USA     |
> 



